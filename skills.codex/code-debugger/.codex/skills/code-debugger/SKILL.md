---
name: code-debugger
description: 基于深度上下文理解的代码调试与增量开发流程。用于修复 Bug、性能问题、变量追踪或在既有模块上做增量功能时，需要建立调用链/变量依赖并维护 `.debug/` 记录的场景。
---

# Code Debugger

## Overview

在修改代码前先建立完整上下文关系网络，最小化变更并记录可追溯的调试文档，确保修复可验证、可回滚、可复盘。

## Workflow

### 1. 上下文构建
- 解析用户任务，识别涉及模块与边界。
- 使用 `rg`/文件浏览定位入口与相关模块，梳理调用链、变量依赖和数据流向。
- 检查 `.debug/`：若已有同模块记录则加载；若模块不同则新建，避免混杂上下文。
- 评估影响范围与潜在回归点，只改必要代码。

### 2. 问题定位与实施
- 基于上下文网络定位根因，给出 1-2 个方案并评估风险。
- 采用最小改动原则实施修复或增量功能，保持现有架构与风格一致。
- 添加必要的边界检查和错误处理。

### 3. 验证与记录
- 运行现有测试或提供明确的手动验证步骤。
- 更新 `.debug/` 记录：问题、根因、变更、验证、影响评估。
- 根据反馈迭代修复与文档。

## .debug 文档规则

### 目录与命名
- 统一放在 `.debug/`。
- 每个功能模块单独一份：`.debug/<module>-debug.md`。

### 模块隔离
- 交叉度计算：`(共享函数数 + 共享变量数 + 共享数据结构数) / 总组件数`。
- 交叉度 > 30%：合并到现有文档。
- 交叉度 < 30%：新建文档。

### 推荐模板（精简版）

```markdown
# [模块] Debug 记录

## 元信息
- 模块名称:
- 创建时间:
- 最后更新:
- 相关文件:
- 依赖模块:

## 上下文关系网络
- 文件结构
- 函数调用链
- 变量依赖图
- 数据流向

## Debug 历史
### [YYYY-MM-DD HH:MM] [任务标题]
- 问题描述
- 根因定位
- 解决方案
- 代码变更（文件/函数）
- 验证结果
- 影响评估

## 待追踪问题
## 技术债务记录
## 架构决策记录（可选）
```

## Response Format (recommended)

在开始与完成任务时，优先用以下结构输出关键信息：

```markdown
## 任务分析
## 上下文探索
## .debug 文档状态
## 执行方案
## 更新记录
```
